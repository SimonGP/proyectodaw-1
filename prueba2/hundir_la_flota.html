
 
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<html>
  <head>
    <title>Tema 3</title>
    <meta http-equiv="content-type" content="text/html;charset=utf-8" />
    <link rel="stylesheet" type="text/css" href="diw21.css"/>    
</head>
<body>
	<h1>Hundir la flota</h1>
	<h2>Hola soy una modificacion</h2>
	<h3>Segunda</h3>
	<div id="contenedor">
	<script type="text/javascript">
		function rellenarTableroTd(tablero){		
			for(var x=0;x<15;x++){
				tablero[x]=[]		
				for(var i=0;i<15;i++){
					tablero[x][i]=crearTd()
				}
			}		
			return tablero
		}	
			
		function crearTd(){		
			var td=document.createElement("td")	
			td.setAttribute("bgcolor","white")
			td.width="50"
			td.height="30"		
			return td		
		}
		
		function crearTdG(fila){		
			var td=document.createElement("td")	
			var texto=document.createTextNode(""+fila)
			td.appendChild(texto)
			td.setAttribute("bgcolor","white")
			td.width="50"
			td.height="30"		
			return td		
		}
		
		function crearTrG(){
			var tr=document.createElement("tr")			
			tr.appendChild(crearTd())
			for (var x=0;x<15;x++){			
				tr.appendChild(crearTdG(x+1))
			}			
			return tr
		}
	
		function crearTr(fila){
			var tr=document.createElement("tr")	
			tr.appendChild(crearTdG(fila+1))
			for (var x=0;x<15;x++){			
				tr.appendChild(tablaarray[fila][x])
			}			
			return tr
		}
		
		function crearTabla(){		
			var tabla=document.createElement("table")			
			tabla.border="2"
			tabla.appendChild(crearTrG())
			for(var x=0;x<15;x++){			
				tabla.appendChild(crearTr(x))				
			}				
			return tabla			
		}			
		
		var tablaarray=[]
		tablaarray=rellenarTableroTd(tablaarray)		
		var inicio=document.getElementById("contenedor")			
		inicio.appendChild(crearTabla())
		var cuadro=document.createElement("p")		
		
		var boton=document.createElement("input")
		boton.id="miBoton"	
		boton.type="submit"
		boton.value="disparo"		
		var caja=document.createElement("input")
		caja.id="disparo"
		caja.type="text"	
		caja.size="5"		
		var texto3=document.createTextNode("Inserte la Fila y Columna separado por '/': ")
		cuadro.appendChild(texto3)
		cuadro.appendChild(caja)		
		inicio.appendChild(cuadro)		
		inicio.appendChild(boton)			
	
		function barco(){
			this.nombre=""
			this.tamano=0
			this.vidas=0
			this.posicionC=[]
			this.posicionF=[]		
		}
	
		function comprobar(barco, coordenadas){
			var nombre="no"			
			for(var e=0;e<barco.posicionC.length;e++){
				if(barco.posicionC[e]==coordenadas[1]){
					nombre=barco.nombre
				}
			}
			if(nombre!="no"){
				if(barco.posicionF[0]==coordenadas[0]){
					nombre=barco.nombre
				}
			}					
			if(nombre!="no"){
				barco.vidas=barco.vidas-1
			}			
			return nombre
		}
	
		function rellenarBarco(barco,nombre,tam){
			barco.nombre=nombre
			barco.tamano=tam
			barco.vidas=tam
			if(tam==2){
				barco.posicionC[0]=1
				barco.posicionC[1]=barco.posicionC[0]+1
				barco.posicionF[0]=4
				barco.posicionF[1]=barco.posicionF[0]
			}else if(tam==3){
				barco.posicionC[0]=4
				barco.posicionC[1]=barco.posicionC[0]+1
				barco.posicionC[2]=barco.posicionC[1]+1
				barco.posicionF[0]=5
				barco.posicionF[1]=barco.posicionF[0]
				barco.posicionF[2]=barco.posicionF[0]
			} else if(tam==4){
				barco.posicionC[0]=9
				barco.posicionC[1]=barco.posicionC[0]+1
				barco.posicionC[2]=barco.posicionC[1]+1
				barco.posicionC[3]=barco.posicionC[2]+1
				barco.posicionF[0]=6
				barco.posicionF[1]=barco.posicionF[0]
				barco.posicionF[2]=barco.posicionF[0]
				barco.posicionF[3]=barco.posicionF[0]
			}		
		}	
	
		function pintarBarcos(barco){
			if(barco.tamano==2){
				dibujar[barco.posicionF[0]][barco.posicionC[0]]=1
				dibujar[barco.posicionF[1]][barco.posicionC[1]]=1
			}else if(barco.tamano==3){
				dibujar[barco.posicionF[0]][barco.posicionC[0]]=1
				dibujar[barco.posicionF[1]][barco.posicionC[1]]=1
				dibujar[barco.posicionF[2]][barco.posicionC[2]]=1
			}else if(barco.tamano==4){
				dibujar[barco.posicionF[0]][barco.posicionC[0]]=1
				dibujar[barco.posicionF[1]][barco.posicionC[1]]=1
				dibujar[barco.posicionF[2]][barco.posicionC[2]]=1
				dibujar[barco.posicionF[3]][barco.posicionC[3]]=1
			}		
		}

		function tablero(){
			this.tablero=[];
		}	
	
		function rellenarTablero(tablero){		
			for(var x=0;x<15;x++){
				tablero[x]=[]		
				for(var i=0;i<15;i++){
					tablero[x][i]=0
				}
			}		
		}	
	
		var dibujar=new tablero();
		rellenarTablero(dibujar)
		
		var barco2=new barco()	
		rellenarBarco(barco2,"dos", 2)
		pintarBarcos(barco2)
		
		var barco3=new barco()
		rellenarBarco(barco3,"tres", 3)
		pintarBarcos(barco3)
		
		var barco4=new barco()
		rellenarBarco(barco4,"cuatro", 4)
		pintarBarcos(barco4)
		
		var barcos=[]
		barcos=[barco2, barco3, barco4]
		
		var tiro=document.getElementById("miBoton")
		//tiro.onclick=disparo
		tiro.addEventListener("click",disparo)
		
	
	function disparo(){
			var salir=true
			var coordenadas=[]
			var nombreBarco="no"
			var contador=-1
			var tiro=document.getElementById("disparo")
			var coor=tiro.value
			coordenadas=coor.split("/")
			coordenadas[0]=coordenadas[0]-1
			coordenadas[1]=coordenadas[1]-1
			if(coordenadas[0]>14||coordenadas[0]<0||coordenadas[1]>14||coordenadas[1]<0){
				alert("Coordenadas incorrectas")
			}else{
					if(dibujar[coordenadas[0]][coordenadas[1]]==1){
						dibujar[coordenadas[0]][coordenadas[1]]=-2
						disparo=tablaarray[coordenadas[0]][coordenadas[1]]
						disparo.setAttribute("bgcolor","red")
						contador=-1
						do {
							contador++;
							nombreBarco=comprobar(barcos[contador],coordenadas)							
						}while(nombreBarco=="no")
					
						if(barcos[contador].vidas==0){
							alert ("Has hundido el barco numero "+barcos[contador].nombre)
						}else{
							alert("Impacto en el barco numero "+barcos[contador].nombre)
						}
					}else{
						if(dibujar[coordenadas[0]][coordenadas[1]]==0){
							dibujar[coordenadas[0]][coordenadas[1]]=-1;	
							disparo=tablaarray[coordenadas[0]][coordenadas[1]]
							disparo.setAttribute("bgcolor","blue")
						}
						alert('Disparo fallido')
					}
					
					var suma=0
					for(var y=0;y<barcos.length;y++){
						suma=suma+barcos[y].vidas		
					}
					if(suma==0){
						salir=false
					}			
			}	
			tiro.value=""
		}	
    </script>
	</div>	
	<iframe frameBorder="0" scrolling="no" src="https://es.wikiloc.com/wikiloc/spatialArtifacts.do?event=view&id=16782225&measures=on&title=on&near=off&images=off&maptype=M" width="500" height="600"></iframe><div style="background-color:#fff;color:#777;font-size:11px;line-height:16px;">Powered by <a style="color:#06d;font-size:11px;line-height:16px;" target="_blank" href="https://es.wikiloc.com">Wikiloc</a></div>	
</body>
</html>
